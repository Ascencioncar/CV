<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reserva tu Turno - Barbería</title>
  <style>
    /* ==================== CSS COMPLETO ==================== */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #333;
    }
    .container {
        max-width: 600px;
        margin: 40px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    header {
        text-align: center;
        margin-bottom: 30px;
    }
    h1 {
        color: #333;
        margin-bottom: 10px;
    }
    .logo {
        font-size: 32px;
        margin-bottom: 10px;
    }
    .step {
        margin-bottom: 25px;
    }
    .step-title {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        font-weight: bold;
        font-size: 18px;
    }
    .step-number {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        background-color: #333;
        color: white;
        border-radius: 50%;
        margin-right: 10px;
    }
    .services {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 15px;
    }
    .service-option {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
    }
    .service-option:hover {
        border-color: #333;
    }
    .service-option.selected {
        background-color: #333;
        color: white;
        border-color: #333;
    }
    .service-name {
        font-weight: 600;
        margin-bottom: 5px;
    }
    .service-price {
        color: #666;
        font-size: 14px;
    }
    .service-option.selected .service-price {
        color: #f5f5f5;
    }
    .barbers {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 15px;
    }
    .barber-option {
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
    }
    .barber-option:hover {
        border-color: #333;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .barber-option.selected {
        background-color: #333;
        color: white;
        border-color: #333;
    }
    .barber-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin: 0 auto 10px;
        object-fit: cover;
        border: 3px solid #ddd;
        transition: border-color 0.3s;
    }
    .barber-option.selected .barber-avatar {
        border-color: white;
    }
    .barber-name {
        font-weight: 600;
        margin-bottom: 5px;
    }
    .barber-experience {
        color: #666;
        font-size: 14px;
    }
    .barber-option.selected .barber-experience {
        color: #f5f5f5;
    }
    .calendar {
        margin-bottom: 20px;
    }
    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .month-nav {
        cursor: pointer;
        padding: 5px 10px;
        background-color: #eee;
        border-radius: 4px;
    }
    .days-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }
    .day-name {
        text-align: center;
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 14px;
    }
    .day {
        padding: 10px 0;
        text-align: center;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
    }
    .day:hover {
        background-color: #f0f0f0;
    }
    .day.selected {
        background-color: #333;
        color: white;
    }
    .day.disabled {
        color: #ccc;
        cursor: not-allowed;
    }
    .time-sections {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 20px;
    }
    .time-section {
        border: 1px solid #eee;
        border-radius: 8px;
        padding: 15px;
        background-color: #fafafa;
    }
    .time-section.selected {
        border-color: #333;
        background-color: #f0f0f0;
    }
    .time-section-title {
        font-weight: bold;
        text-align: center;
        margin-bottom: 10px;
        color: #333;
    }
    .time-section-subtitle {
        text-align: center;
        font-size: 12px;
        color: #666;
        margin-bottom: 15px;
    }
    .time-slots {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
    }
    .time-slot {
        padding: 8px;
        text-align: center;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
    }
    .time-slot:hover {
        background-color: #e0e0e0;
    }
    .time-slot.selected {
        background-color: #333;
        color: white;
    }
    .time-slot.disabled {
        color: #ccc;
        cursor: not-allowed;
        background-color: #f9f9f9;
    }
    .summary {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
    }
    .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    .summary-label {
        font-weight: bold;
    }
    .btn {
        width: 100%;
        padding: 15px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 20px;
        transition: background-color 0.3s;
    }
    .btn:hover {
        background-color: #555;
    }
    .btn-secondary {
        background-color: #666;
        margin-top: 10px;
    }
    .btn-secondary:hover {
        background-color: #777;
    }
    .form-group {
        margin-bottom: 20px;
    }
    .form-label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
    }
    .form-input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        transition: border-color 0.3s;
    }
    .form-input:focus {
        outline: none;
        border-color: #333;
    }
    .form-input.error {
        border-color: #e74c3c;
    }
    .error-message {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 5px;
    }
    .hidden {
        display: none;
    }
    .step-container {
        overflow: hidden;
        transition: height 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">✂️</div>
      <h1>BARBER MOYAS</h1>
      <h2>Dirección: Dg53B#14</h2>
      <p>Reserva tu turno en simples pasos</p>
    </header>

    <!-- =========== PASO 1: DATOS DEL CLIENTE =========== -->
    <div class="step" id="step1">
      <div class="step-title">
        <div class="step-number">1</div>
        Información personal
      </div>
      <div class="form-group">
        <label class="form-label" for="customerName">Nombre completo *</label>
        <input type="text" id="customerName" class="form-input" placeholder="Ingresa tu nombre completo">
        <div class="error-message" id="nameError"></div>
      </div>
      <div class="form-group">
        <label class="form-label" for="customerEmail">Correo electrónico *</label>
        <input type="email" id="customerEmail" class="form-input" placeholder="ejemplo@correo.com">
        <div class="error-message" id="emailError"></div>
      </div>
      <div class="form-group">
        <label class="form-label" for="customerPhone">Número de teléfono *</label>
        <input type="tel" id="customerPhone" class="form-input" placeholder="3001234567">
        <div class="error-message" id="phoneError"></div>
      </div>
      <button class="btn" onclick="validateCustomerInfo()">Continuar</button>
    </div>

    <!-- =========== PASO 2: SELECCIONAR SERVICIO =========== -->
    <div class="step hidden" id="step2">
      <div class="step-title">
        <div class="step-number">2</div>
        Selecciona un servicio
      </div>
      <div class="services">
        <!-- Cada opción de servicio con data-name y data-price -->
        <div class="service-option"
             data-name="Corte De Cabello"
             data-price="18000.00"
             onclick="selectService(this)">
          <div class="service-name">Corte De Cabello</div>
          <div class="service-price">$ 18.000 - 30min</div>
          <div style="font-size: 12px; color: #666; margin-top: 5px;">
            Diseño de corte que incluye asesoría, lavado de cabello y peinado
          </div>
        </div>
        <div class="service-option"
             data-name="Corte De Cabello + Barba"
             data-price="25000.00"
             onclick="selectService(this)">
          <div class="service-name">Corte De Cabello + Barba</div>
          <div class="service-price">$ 25.000 - 45min</div>
        </div>
        <div class="service-option"
             data-name="Marcada de patillas+barba"
             data-price="12000.00"
             onclick="selectService(this)">
          <div class="service-name">Marcada de patillas+barba</div>
          <div class="service-price">$ 12.000 - 15min</div>
        </div>
        <div class="service-option"
             data-name="Marcada de patillas"
             data-price="10000.00"
             onclick="selectService(this)">
          <div class="service-name">Marcada de patillas</div>
          <div class="service-price">$ 10.000 - 5min</div>
          <div style="font-size: 12px; color: #666; margin-top: 5px;">
            Retoque de contornos perfilando patillas, frente y nuca
          </div>
        </div>
        <div class="service-option"
             data-name="Depilación De Cejas"
             data-price="9000.00"
             onclick="selectService(this)">
          <div class="service-name">Depilación De Cejas</div>
          <div class="service-price">$ 9.000 - 5min</div>
        </div>
        <div class="service-option"
             data-name="Rayitos"
             data-price="60000.00"
             onclick="selectService(this)">
          <div class="service-name">RAYITOS</div>
          <div class="service-price">$ 60.000 - 150min</div>
        </div>
        <div class="service-option"
             data-name="Diseño De Barba Con Pigmentación"
             data-price="14000.00"
             onclick="selectService(this)">
          <div class="service-name">DISEÑO DE BARBA CON PIGMENTACIÓN</div>
          <div class="service-price">$ 14.000 - 20min</div>
        </div>
        <div class="service-option"
             data-name="Decoloración"
             data-price="90000.00"
             onclick="selectService(this)">
          <div class="service-name">DECOLORACIÓN</div>
          <div class="service-price">$ 90.000 - 160min</div>
        </div>
      </div>
      <button class="btn btn-secondary" onclick="goBack(1)">Volver</button>
    </div>

    <!-- =========== PASO 3: SELECCIONAR BARBERO =========== -->
    <div class="step hidden" id="step3">
      <div class="step-title">
        <div class="step-number">3</div>
        Selecciona tu barbero
      </div>
      <div class="barbers">
        <!-- Cada opción de barbero con data-barber-id y data-barber-name -->
        <div class="barber-option"
             data-barber-id="1"
             data-barber-name="Juan Pablo"
             onclick="selectBarber(this)">
          <img src="Assets/Barberia/Pablo.jpg" alt="Juan Pablo" class="barber-avatar">
          <div class="barber-name">Juan Pablo</div>
          <div class="barber-experience"></div>
        </div>
        <div class="barber-option"
             data-barber-id="2"
             data-barber-name="Juan David"
             onclick="selectBarber(this)">
          <img src="Assets/Barberia/JuanDavid.jpg" alt="Juan David" class="barber-avatar">
          <div class="barber-name">Juan David</div>
          <div class="barber-experience"></div>
        </div>
        
      </div>
      <button class="btn btn-secondary" onclick="goBack(2)">Volver</button>
    </div>

    <!-- =========== PASO 4: SELECCIONAR FECHA =========== -->
    <div class="step hidden" id="step4">
      <div class="step-title">
        <div class="step-number">4</div>
        Selecciona una fecha
      </div>
      <div class="calendar">
        <div class="calendar-header">
          <div class="month-nav" onclick="changeMonth(-1)">&#9664; Anterior</div>
          <div class="current-month" id="currentMonth">Junio 2025</div>
          <div class="month-nav" onclick="changeMonth(1)">Siguiente &#9654;</div>
        </div>
        <div class="days-grid">
          <div class="day-name">Do</div>
          <div class="day-name">Lu</div>
          <div class="day-name">Ma</div>
          <div class="day-name">Mi</div>
          <div class="day-name">Ju</div>
          <div class="day-name">Vi</div>
          <div class="day-name">Sa</div>
        </div>
        <div class="days-grid" id="calendar-days"></div>
      </div>
      <button class="btn btn-secondary" onclick="goBack(3)">Volver</button>
    </div>

    <!-- =========== PASO 5: SELECCIONAR HORA =========== -->
    <div class="step hidden" id="step5">
      <div class="step-title">
        <div class="step-number">5</div>
        Horarios disponibles
      </div>
      <p style="text-align: center; margin-bottom: 20px; color: #666;">
        <span id="selected-date-display">Fecha seleccionada</span>
      </p>
      <div class="time-sections">
        <div class="time-section" data-period="morning">
          <div class="time-section-title">MAÑANA</div>
          <div class="time-section-subtitle">Sin horas para reservar</div>
          <div class="time-slots" id="morning-slots"></div>
        </div>
        <div class="time-section" data-period="afternoon">
          <div class="time-section-title">TARDE</div>
          <div class="time-section-subtitle">Sin horas para reservar</div>
          <div class="time-slots" id="afternoon-slots"></div>
        </div>
        <div class="time-section" data-period="evening">
          <div class="time-section-title">NOCHE</div>
          <div class="time-section-subtitle">Sin horas para reservar</div>
          <div class="time-slots" id="evening-slots"></div>
        </div>
      </div>
      <button class="btn btn-secondary" onclick="goBack(4)">Volver</button>
    </div>

    <!-- =========== PASO 6: CONFIRMAR RESERVA =========== -->
    <div class="step hidden" id="step6">
      <div class="step-title">
        <div class="step-number">6</div>
        Confirma tu reserva
      </div>
      <div class="summary">
        <div class="summary-row">
          <span class="summary-label">Cliente:</span>
          <span id="summary-customer">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Email:</span>
          <span id="summary-email">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Teléfono:</span>
          <span id="summary-phone">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Servicio:</span>
          <span id="summary-service">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Barbero:</span>
          <span id="summary-barber">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Precio:</span>
          <span id="summary-price">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Fecha:</span>
          <span id="summary-date">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Hora:</span>
          <span id="summary-time">-</span>
        </div>
      </div>
      <button class="btn" onclick="confirmBooking()">Confirmar Reserva</button>
      <button class="btn btn-secondary" onclick="goBack(5)">Volver</button>
    </div>

    <!-- =========== PASO 7: RESERVA CONFIRMADA =========== -->
    <div class="step hidden" id="step7">
      <div style="text-align: center; padding: 40px 0;">
        <div style="font-size: 50px; margin-bottom: 20px;">✅</div>
        <h2>¡Reserva Confirmada!</h2>
        <p><strong><span id="confirmed-customer">-</span></strong></p>
        <p>Te esperamos el <span id="confirmed-date">-</span> a las <span id="confirmed-time">-</span></p>
        <p>Con el barbero: <span id="confirmed-barber">-</span></p>
        <p>Servicio: <span id="confirmed-service">-</span></p>
        <p>Te enviaremos la confirmación a: <span id="confirmed-email">-</span></p>
        <button class="btn" onclick="startOver()">Hacer otra reserva</button>
      </div>
    </div>
  </div>

  <script>
    // =================== VARIABLES GLOBALES ===================
    let currentStep = 1;
    let customerName = '';
    let customerEmail = '';
    let customerPhone = '';
    let selectedServiceName = '';
    let selectedServicePrice = '';
    let selectedBarberId = '';
    let selectedBarberName = '';
    let selectedDateDisplay = '';
    let selectedDateISO = '';
    let selectedTimeDisplay = '';
    let selectedTimeISO = '';
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    // Ajusta esta URL si tu backend corre en otro puerto u host
    const API_URL = 'https://backend-barberia-gamma.vercel.app';


    // --------------- FUNCIONES DE NAVEGACIÓN ---------------
    function showStep(stepNum) {
      document.querySelectorAll('.step').forEach((stepElem, index) => {
        if (index + 1 === stepNum) {
          stepElem.classList.remove('hidden');
        } else {
          stepElem.classList.add('hidden');
        }
      });
      currentStep = stepNum;

      // Si entramos al calendario (paso 4), dibujamos el mes actual
      if (currentStep === 4) {
        const today = new Date();
        currentMonth = today.getMonth();
        currentYear = today.getFullYear();
        renderCalendar();
      }
    }

    function nextStep() {
      if (currentStep === 5) {
        updateSummary();
      }
      showStep(currentStep + 1);
    }

    function goBack(stepNum) {
      showStep(stepNum);
    }


    // --------------- VALIDACIÓN DATOS DEL CLIENTE ---------------
    function validateCustomerInfo() {
      const name = document.getElementById('customerName').value.trim();
      const email = document.getElementById('customerEmail').value.trim();
      const phone = document.getElementById('customerPhone').value.trim();
      let isValid = true;

      document.getElementById('nameError').textContent = '';
      document.getElementById('emailError').textContent = '';
      document.getElementById('phoneError').textContent = '';
      document.getElementById('customerName').classList.remove('error');
      document.getElementById('customerEmail').classList.remove('error');
      document.getElementById('customerPhone').classList.remove('error');

      if (!name) {
        document.getElementById('nameError').textContent = 'El nombre es obligatorio';
        document.getElementById('customerName').classList.add('error');
        isValid = false;
      } else if (name.length < 2) {
        document.getElementById('nameError').textContent = 'El nombre debe tener al menos 2 caracteres';
        document.getElementById('customerName').classList.add('error');
        isValid = false;
      }

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email) {
        document.getElementById('emailError').textContent = 'El correo electrónico es obligatorio';
        document.getElementById('customerEmail').classList.add('error');
        isValid = false;
      } else if (!emailRegex.test(email)) {
        document.getElementById('emailError').textContent = 'Por favor ingresa un correo electrónico válido';
        document.getElementById('customerEmail').classList.add('error');
        isValid = false;
      }

      const phoneRegex = /^[0-9]{10}$/;
      if (!phone) {
        document.getElementById('phoneError').textContent = 'El número de teléfono es obligatorio';
        document.getElementById('customerPhone').classList.add('error');
        isValid = false;
      } else if (!phoneRegex.test(phone)) {
        document.getElementById('phoneError').textContent = 'Por favor ingresa un número de teléfono válido (10 dígitos)';
        document.getElementById('customerPhone').classList.add('error');
        isValid = false;
      }

      if (isValid) {
        customerName = name;
        customerEmail = email;
        customerPhone = phone;
        nextStep();
      }
    }


    // ----------------- CALENDARIO -----------------
    function renderCalendar() {
      const daysContainer = document.getElementById('calendar-days');
      daysContainer.innerHTML = '';

      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const prevMonthLastDay = new Date(currentYear, currentMonth, 0);

      document.getElementById('currentMonth').textContent =
        new Date(currentYear, currentMonth).toLocaleDateString('es', { month: 'long', year: 'numeric' });

      // Celdas vacías antes del primer día
      for (let i = 0; i < firstDay.getDay(); i++) {
        const dayElem = document.createElement('div');
        dayElem.className = 'day disabled';
        dayElem.textContent = prevMonthLastDay.getDate() - (firstDay.getDay() - i - 1);
        daysContainer.appendChild(dayElem);
      }

      // Días del mes actual
      const today = new Date();
      for (let i = 1; i <= lastDay.getDate(); i++) {
        const dayElem = document.createElement('div');
        dayElem.className = 'day';
        dayElem.textContent = i;

        const thisDate = new Date(currentYear, currentMonth, i);
        if (thisDate < new Date(today.getFullYear(), today.getMonth(), today.getDate())) {
          dayElem.classList.add('disabled');
        } else {
          dayElem.addEventListener('click', () => selectDate(i));
        }
        daysContainer.appendChild(dayElem);
      }

      // Rellenar hasta completar 6 filas (42 celdas)
      const totalDays = firstDay.getDay() + lastDay.getDate();
      const remaining = 42 - totalDays;
      for (let i = 1; i <= remaining; i++) {
        const dayElem = document.createElement('div');
        dayElem.className = 'day disabled';
        dayElem.textContent = i;
        daysContainer.appendChild(dayElem);
      }
    }

    function changeMonth(direction) {
      currentMonth += direction;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }


    // ------------ SELECCIÓN DE SERVICIO Y BARBERO ------------
    function selectService(elem) {
      document.querySelectorAll('.service-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      elem.classList.add('selected');
      selectedServiceName = elem.getAttribute('data-name');
      selectedServicePrice = parseFloat(elem.getAttribute('data-price'));
      setTimeout(nextStep, 300);
    }

    function selectBarber(elem) {
      document.querySelectorAll('.barber-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      elem.classList.add('selected');
      selectedBarberId = parseInt(elem.getAttribute('data-barber-id'), 10);
      selectedBarberName = elem.getAttribute('data-barber-name');
      setTimeout(nextStep, 300);
    }


    // ------------ SELECCIÓN DE FECHA Y HORA ------------
    function selectDate(day) {
      document.querySelectorAll('.day').forEach(d => {
        if (!d.classList.contains('disabled')) {
          d.classList.remove('selected');
        }
      });
      event.currentTarget.classList.add('selected');

      const monthNames = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
      selectedDateDisplay = `${day} de ${monthNames[currentMonth]} de ${currentYear}`;
      document.getElementById('selected-date-display').textContent = selectedDateDisplay;

      const mm = String(currentMonth + 1).padStart(2, '0');
      const dd = String(day).padStart(2, '0');
      selectedDateISO = `${currentYear}-${mm}-${dd}`;

      generateTimeSlots();
      setTimeout(nextStep, 300);
    }

    function generateTimeSlots() {
      const morningContainer = document.getElementById('morning-slots');
      const afternoonContainer = document.getElementById('afternoon-slots');
      const eveningContainer = document.getElementById('evening-slots');
      morningContainer.innerHTML = '';
      afternoonContainer.innerHTML = '';
      eveningContainer.innerHTML = '';

      const slots = { morning: [], afternoon: [], evening: [] };
      let hour = 8, minute = 0;

      while (hour < 20) {
        const h12 = hour % 12 === 0 ? 12 : hour % 12;
        const amPm = hour < 12 ? 'AM' : 'PM';
        const mm = minute === 0 ? '00' : minute;
        const displayText = `${h12}:${mm} ${amPm}`;
        const hour24 = String(hour).padStart(2,'0');
        const min24 = String(minute).padStart(2,'0');
        const isoText = `${hour24}:${min24}:00`;

        if (hour < 12) {
          slots.morning.push({ display: displayText, iso: isoText });
        } else if (hour < 18) {
          slots.afternoon.push({ display: displayText, iso: isoText });
        } else {
          slots.evening.push({ display: displayText, iso: isoText });
        }

        minute += 30;
        if (minute >= 60) {
          hour++;
          minute = minute % 60;
        }
      }

      createTimeSlotElements(slots.morning, morningContainer);
      createTimeSlotElements(slots.afternoon, afternoonContainer);
      createTimeSlotElements(slots.evening, eveningContainer);
      updateSectionSubtitles();
    }

    function createTimeSlotElements(arr, container) {
      const sectionElem = container.closest('.time-section');
      if (arr.length === 0) {
        sectionElem.querySelector('.time-section-subtitle').textContent = 'Sin horas para reservar';
        return;
      }
      sectionElem.querySelector('.time-section-subtitle').textContent = '';
      arr.forEach(obj => {
        const slotElem = document.createElement('div');
        slotElem.className = 'time-slot';
        slotElem.textContent = obj.display;
        slotElem.dataset.timeIso = obj.iso;
        slotElem.addEventListener('click', () => selectTime(obj.display, obj.iso));
        container.appendChild(slotElem);
      });
    }

    function updateSectionSubtitles() {
      document.querySelectorAll('.time-section').forEach(sec => {
        const cnt = sec.querySelector('.time-slots');
        const sub = sec.querySelector('.time-section-subtitle');
        if (cnt.children.length === 0) {
          sub.textContent = 'Sin horas para reservar';
        } else {
          sub.textContent = '';
        }
      });
    }

    function selectTime(displayTxt, isoTxt) {
      document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
      selectedTimeDisplay = displayTxt;
      selectedTimeISO = isoTxt;
      setTimeout(nextStep, 300);
    }


    // ------------ CONFIRMAR RESERVA Y ENVIAR A LA API ------------
    function updateSummary() {
      document.getElementById('summary-customer').textContent = customerName;
      document.getElementById('summary-email').textContent = customerEmail;
      document.getElementById('summary-phone').textContent = customerPhone;
      document.getElementById('summary-service').textContent = selectedServiceName;
      document.getElementById('summary-barber').textContent = selectedBarberName;
      document.getElementById('summary-price').textContent = `$ ${Number(selectedServicePrice).toLocaleString('es')}`;
      document.getElementById('summary-date').textContent = selectedDateDisplay;
      document.getElementById('summary-time').textContent = selectedTimeDisplay;
    }

    async function confirmBooking() {
      // 1) Actualizar pantalla final
      document.getElementById('confirmed-customer').textContent = customerName;
      document.getElementById('confirmed-email').textContent   = customerEmail;
      document.getElementById('confirmed-date').textContent    = selectedDateDisplay;
      document.getElementById('confirmed-time').textContent    = selectedTimeDisplay;
      document.getElementById('confirmed-barber').textContent  = selectedBarberName;
      document.getElementById('confirmed-service').textContent = selectedServiceName;

      // 2) Crear payload para la API
      const payload = {
        cliente: {
          nombre: customerName,
          correo: customerEmail,
          telefono: customerPhone
        },
        reserva: {
          servicio_nombre: selectedServiceName,
          servicio_precio: selectedServicePrice,
          id_barbero:      selectedBarberId,
          fecha:           selectedDateISO,
          hora:            selectedTimeISO
        }
      };

      try {
        // 3) Enviar POST a /reservas
        const resp = await fetch(`${API_URL}/reservas`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });
        if (!resp.ok) {
          let msg = resp.statusText;
          try {
            const errJson = await resp.json();
            if (errJson.error) msg = errJson.error;
          } catch (_) {}
          alert(`Error al guardar la reserva: ${msg}`);
          return;
        }
        // 4) Si todo OK, mostrar confirmación
        nextStep();
      } catch (e) {
        alert('No se pudo conectar al servidor. Intenta de nuevo más tarde.');
        console.error('confirmBooking error:', e);
      }
    }


    // ------------ REINICIAR PROCESO ------------
    function startOver() {
      currentStep = 1;
      customerName = '';
      customerEmail = '';
      customerPhone = '';
      selectedServiceName = '';
      selectedServicePrice = '';
      selectedBarberId = '';
      selectedBarberName = '';
      selectedDateDisplay = '';
      selectedDateISO = '';
      selectedTimeDisplay = '';
      selectedTimeISO = '';
      currentMonth = new Date().getMonth();
      currentYear = new Date().getFullYear();

      document.getElementById('customerName').value = '';
      document.getElementById('customerEmail').value = '';
      document.getElementById('customerPhone').value = '';

      document.querySelectorAll('.service-option').forEach(opt => opt.classList.remove('selected'));
      document.querySelectorAll('.barber-option').forEach(opt => opt.classList.remove('selected'));
      document.querySelectorAll('.day').forEach(d => d.classList.remove('selected'));
      document.querySelectorAll('.time-slot').forEach(ts => ts.classList.remove('selected'));

      showStep(1);
    }


    // ------------ INICIALIZAR AL CARGAR ------------
    document.addEventListener('DOMContentLoaded', () => {
      showStep(1);
    });
  </script>
</body>
</html>
